<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dell SRO | Global Intelligence Dashboard</title>

  <!-- CDN CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
    :root { --dell-blue: #0076CE; --bg-dark: #0f1115; }
    body { background-color: var(--bg-dark); font-family: 'Inter',sans-serif; padding:24px; color:#333; margin:0; }
    .app-container{ background:#fff;border-radius:24px;min-height:92vh; display:flex;flex-direction:column; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.5); margin:16px; }
    /* Keep your other CSS as needed in repo; this is the minimal wrapper */
  </style>
</head>

<body>
  <div class="app-container">
    <div class="header-container">
      <div class="header-left">
        <div class="logo-icon"><i class="fas fa-shield-alt"></i></div>
        <div class="logo-text">SRO <span>INTELLIGENCE</span></div>
      </div>
      <div class="header-right">
        <div class="nav-pills-custom">
          <a class="nav-item-custom active" onclick="filterNews('Global')">Global</a>
          <a class="nav-item-custom" onclick="filterNews('AMER')">AMER</a>
          <a class="nav-item-custom" onclick="filterNews('EMEA')">EMEA</a>
          <a class="nav-item-custom" onclick="filterNews('APJC')">APJC</a>
          <a class="nav-item-custom" onclick="filterNews('LATAM')">LATAM</a>
        </div>
        <div class="clock-container ms-3">
          <div class="clock-date" id="clock-date">Loading...</div>
          <div id="clock-time"></div>
        </div>
        <div class="btn-daily ms-3" data-bs-toggle="modal" data-bs-target="#reportModal">
          <i class="fas fa-file-alt"></i> Daily Briefings
        </div>
      </div>
    </div>

    <div class="content-area">
      <div class="row g-4 h-100">
        <div class="col-lg-9 d-flex flex-column">
          <div class="map-wrapper mb-3"><div id="map"></div></div>
          <div class="stream-section">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <div class="fw-bold"><i class="fas fa-circle text-primary me-2" style="font-size:.6rem"></i> Real-time Intelligence Stream</div>
              <div id="status-badge" class="badge bg-light text-secondary">CONNECTING</div>
            </div>

            <div id="critical-alert-banner" style="display:none;" class="critical-alert-bar">
              <i class="fas fa-exclamation-triangle alert-icon-lg"></i>
              <div class="alert-content-main" id="headline-alert"></div>
            </div>

            <div id="general-news-feed">Loading...</div>
          </div>
        </div>

        <div class="col-lg-3 sidebar-col">
          <div class="side-card">
            <div class="card-label"><i class="fas fa-history"></i> History Search</div>
            <div class="history-input-group">
              <i class="fas fa-calendar-alt calendar-icon"></i>
              <input type="date" class="history-input" id="history-picker" onchange="loadHistory(this.value)">
            </div>
            <div class="small text-muted mt-2">Pick a date to load archived intelligence.</div>
          </div>

          <div class="side-card">
            <div class="card-label"><i class="fas fa-plane"></i> Travel Safety Check</div>
            <select class="travel-select" id="countrySelect" onchange="filterTravel()"><option selected disabled>Select Country...</option></select>
            <div id="travel-advisories" class="mt-3"></div>
            <div id="travel-news" class="mt-2"></div>
          </div>

          <div class="side-card">
            <div class="prox-header-row">
              <div><div class="prox-dell-label">Dell Asset</div><div class="prox-main-title">Proximity Alerts</div></div>
            </div>
            <div class="mt-2 mb-3">
              <select id="proxRadius" class="form-select form-select-sm" onchange="updateProximityRadius()">
                <option value="5" selected>5 KM (Default)</option>
                <option value="10">10 KM</option>
                <option value="25">25 KM</option>
                <option value="50">50 KM</option>
              </select>
            </div>
            <div id="proximity-alerts-container" class="text-center p-3 text-muted small">Currently no alerts in proximity to Dell sites.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="reportModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header"><h5 class="modal-title">Daily Briefings</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
        <div class="modal-body">
          <select class="form-select mb-3" id="reportRegion"><option>Global</option><option>APJC</option></select>
          <button class="btn-download" onclick="downloadReport()">Download</button>
        </div>
      </div>
    </div>
  </div>

  <!-- load the app from the public folder (deferred so DOM is ready) -->
  <script src="public/app.js" defer></script>

  <!-- small defensive fallback so the page never looks blank forever -->
  <script>
    setTimeout(() => {
      if (!window.map && document.getElementById('general-news-feed') && document.getElementById('general-news-feed').innerText.trim() === 'Loading...') {
        console.warn('App did not initialize â€” check public/app.js and network requests.');
        document.getElementById('general-news-feed').innerHTML = '<div class="p-4 text-center text-danger">App failed to initialize. Check console/network for errors.</div>';
      }
    }, 5000);
  </script>
</body>
</html>
